<!DOCTYPE html><html lang="en-US"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>WebSocket知识盘点 | Tony&#39;s Blob</title><meta name="generator" content="VuePress 1.9.7"><link rel="icon" href="/favicon.ico"><link rel="manifest" href="/manifest.json"><meta name="description" content="越努力越幸运"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><link rel="preload" href="/assets/css/0.styles.6a238085.css" as="style"><link rel="preload" href="/assets/js/app.0d0b816d.js" as="script"><link rel="preload" href="/assets/js/5.892919e7.js" as="script"><link rel="preload" href="/assets/js/1.2755fd70.js" as="script"><link rel="preload" href="/assets/js/11.7306927b.js" as="script"><link rel="preload" href="/assets/js/28.66f3674d.js" as="script"><link rel="prefetch" href="/assets/js/10.2d8b746a.js"><link rel="prefetch" href="/assets/js/100.df166a06.js"><link rel="prefetch" href="/assets/js/101.6439ed32.js"><link rel="prefetch" href="/assets/js/102.1121151c.js"><link rel="prefetch" href="/assets/js/103.3e76a359.js"><link rel="prefetch" href="/assets/js/104.bfca2561.js"><link rel="prefetch" href="/assets/js/105.9044507b.js"><link rel="prefetch" href="/assets/js/106.997adf38.js"><link rel="prefetch" href="/assets/js/107.e77d8ca1.js"><link rel="prefetch" href="/assets/js/108.eb954849.js"><link rel="prefetch" href="/assets/js/109.d9cda440.js"><link rel="prefetch" href="/assets/js/110.625aa23f.js"><link rel="prefetch" href="/assets/js/111.1cac25e6.js"><link rel="prefetch" href="/assets/js/112.42f15c43.js"><link rel="prefetch" href="/assets/js/113.0dbcc5a3.js"><link rel="prefetch" href="/assets/js/114.33014ffc.js"><link rel="prefetch" href="/assets/js/115.35cf71ef.js"><link rel="prefetch" href="/assets/js/116.01c234a5.js"><link rel="prefetch" href="/assets/js/117.fb9d8641.js"><link rel="prefetch" href="/assets/js/118.539f295c.js"><link rel="prefetch" href="/assets/js/119.fad32ad1.js"><link rel="prefetch" href="/assets/js/12.c6e91522.js"><link rel="prefetch" href="/assets/js/120.5df335d5.js"><link rel="prefetch" href="/assets/js/13.001595c2.js"><link rel="prefetch" href="/assets/js/14.02d2f58e.js"><link rel="prefetch" href="/assets/js/15.cd0a61a9.js"><link rel="prefetch" href="/assets/js/16.47fbae5c.js"><link rel="prefetch" href="/assets/js/17.1b86b083.js"><link rel="prefetch" href="/assets/js/18.ec4b771d.js"><link rel="prefetch" href="/assets/js/19.150d9d71.js"><link rel="prefetch" href="/assets/js/2.01d0e47b.js"><link rel="prefetch" href="/assets/js/20.c51f0d8d.js"><link rel="prefetch" href="/assets/js/21.acbcf645.js"><link rel="prefetch" href="/assets/js/22.3348683a.js"><link rel="prefetch" href="/assets/js/23.747d1429.js"><link rel="prefetch" href="/assets/js/24.bbe8503f.js"><link rel="prefetch" href="/assets/js/25.16b49346.js"><link rel="prefetch" href="/assets/js/26.b4d4c61a.js"><link rel="prefetch" href="/assets/js/27.0f73da5c.js"><link rel="prefetch" href="/assets/js/29.7292dfe9.js"><link rel="prefetch" href="/assets/js/30.749c05dd.js"><link rel="prefetch" href="/assets/js/31.f7741d98.js"><link rel="prefetch" href="/assets/js/32.49ec845f.js"><link rel="prefetch" href="/assets/js/33.537594e3.js"><link rel="prefetch" href="/assets/js/34.690a88bf.js"><link rel="prefetch" href="/assets/js/35.c1551985.js"><link rel="prefetch" href="/assets/js/36.1d5d245d.js"><link rel="prefetch" href="/assets/js/37.cccaade7.js"><link rel="prefetch" href="/assets/js/38.de457679.js"><link rel="prefetch" href="/assets/js/39.e7b66034.js"><link rel="prefetch" href="/assets/js/40.ccbee85f.js"><link rel="prefetch" href="/assets/js/41.c306953c.js"><link rel="prefetch" href="/assets/js/42.d3738c93.js"><link rel="prefetch" href="/assets/js/43.cf2fceff.js"><link rel="prefetch" href="/assets/js/44.61630d2e.js"><link rel="prefetch" href="/assets/js/45.2fb54828.js"><link rel="prefetch" href="/assets/js/46.a8d1651a.js"><link rel="prefetch" href="/assets/js/47.4232bf85.js"><link rel="prefetch" href="/assets/js/48.04bc80e6.js"><link rel="prefetch" href="/assets/js/49.f3b1192c.js"><link rel="prefetch" href="/assets/js/50.74ae48cd.js"><link rel="prefetch" href="/assets/js/51.def81f07.js"><link rel="prefetch" href="/assets/js/52.e25efc54.js"><link rel="prefetch" href="/assets/js/53.3eb4e970.js"><link rel="prefetch" href="/assets/js/54.e464e7eb.js"><link rel="prefetch" href="/assets/js/55.260fdd9c.js"><link rel="prefetch" href="/assets/js/56.d6bad6eb.js"><link rel="prefetch" href="/assets/js/57.7d882843.js"><link rel="prefetch" href="/assets/js/58.278698e9.js"><link rel="prefetch" href="/assets/js/59.e41b92f7.js"><link rel="prefetch" href="/assets/js/6.9dcaa676.js"><link rel="prefetch" href="/assets/js/60.4592ece3.js"><link rel="prefetch" href="/assets/js/61.ff5a9a77.js"><link rel="prefetch" href="/assets/js/62.0479b225.js"><link rel="prefetch" href="/assets/js/63.ccf2a3f8.js"><link rel="prefetch" href="/assets/js/64.b930e761.js"><link rel="prefetch" href="/assets/js/65.94697052.js"><link rel="prefetch" href="/assets/js/66.8b25a2f7.js"><link rel="prefetch" href="/assets/js/67.bd67af92.js"><link rel="prefetch" href="/assets/js/68.1eff5869.js"><link rel="prefetch" href="/assets/js/69.b334516a.js"><link rel="prefetch" href="/assets/js/7.47390e0c.js"><link rel="prefetch" href="/assets/js/70.d0d96882.js"><link rel="prefetch" href="/assets/js/71.53e631c9.js"><link rel="prefetch" href="/assets/js/72.00110002.js"><link rel="prefetch" href="/assets/js/73.223122e3.js"><link rel="prefetch" href="/assets/js/74.c416c5e6.js"><link rel="prefetch" href="/assets/js/75.a3198c00.js"><link rel="prefetch" href="/assets/js/76.e9434b7c.js"><link rel="prefetch" href="/assets/js/77.3c7b34db.js"><link rel="prefetch" href="/assets/js/78.0ec5cce8.js"><link rel="prefetch" href="/assets/js/79.58d8595c.js"><link rel="prefetch" href="/assets/js/8.f9d35b60.js"><link rel="prefetch" href="/assets/js/80.2c079d93.js"><link rel="prefetch" href="/assets/js/81.0599be26.js"><link rel="prefetch" href="/assets/js/82.6340e086.js"><link rel="prefetch" href="/assets/js/83.72b21f49.js"><link rel="prefetch" href="/assets/js/84.d79ca6e0.js"><link rel="prefetch" href="/assets/js/85.2cce017c.js"><link rel="prefetch" href="/assets/js/86.89069e11.js"><link rel="prefetch" href="/assets/js/87.eafc4c7b.js"><link rel="prefetch" href="/assets/js/88.68c1763f.js"><link rel="prefetch" href="/assets/js/89.1c32e2c7.js"><link rel="prefetch" href="/assets/js/9.0cdc4008.js"><link rel="prefetch" href="/assets/js/90.8a36cbec.js"><link rel="prefetch" href="/assets/js/91.7a2e2b88.js"><link rel="prefetch" href="/assets/js/92.96204ab0.js"><link rel="prefetch" href="/assets/js/93.0dc58dd1.js"><link rel="prefetch" href="/assets/js/94.c305538e.js"><link rel="prefetch" href="/assets/js/95.e93a786a.js"><link rel="prefetch" href="/assets/js/96.6ca5fa7d.js"><link rel="prefetch" href="/assets/js/97.ab1a2b4b.js"><link rel="prefetch" href="/assets/js/98.0c6f192c.js"><link rel="prefetch" href="/assets/js/99.8df560c8.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.509a32e0.js"><link rel="stylesheet" href="/assets/css/0.styles.6a238085.css"></head><body><div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-0f44a727><div data-v-0f44a727><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-0f44a727 data-v-0f44a727><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div></div><div class="password-shadow password-wrapper-out" style="display:none" data-v-355e03f9 data-v-0f44a727 data-v-0f44a727><h3 class="title" data-v-355e03f9 data-v-355e03f9>Tony's Blob</h3><p class="description" data-v-355e03f9 data-v-355e03f9>越努力越幸运</p><label id="box" class="inputBox" data-v-355e03f9 data-v-355e03f9><input type="password" data-v-355e03f9><span data-v-355e03f9>Konck! Knock!</span><button data-v-355e03f9>OK</button></label><div class="footer" data-v-355e03f9 data-v-355e03f9><span data-v-355e03f9><i class="iconfont reco-theme" data-v-355e03f9></i><a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-355e03f9>vuePress-theme-reco</a></span><span data-v-355e03f9><i class="iconfont reco-copyright" data-v-355e03f9></i><a data-v-355e03f9><span data-v-355e03f9>Tony</span>  <span data-v-355e03f9>2018 -</span>2023</a></span></div></div><div class="hide" data-v-0f44a727><header class="navbar" data-v-0f44a727><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><span class="site-name">Tony's Blob</span></a><div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a><div class="color-picker-menu" style="display:none"><div class="mode-options"><h4 class="title">Choose mode</h4><ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div><div class="search-box"><i class="iconfont reco-search"></i><input aria-label="Search" autocomplete="off" spellcheck="false"></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>分类</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none"><li class="dropdown-item"><a href="/categories/算法/" class="nav-link"><i class="undefined"></i>算法</a></li><li class="dropdown-item"><a href="/categories/CSS/" class="nav-link"><i class="undefined"></i>CSS</a></li><li class="dropdown-item"><a href="/categories/设计模式/" class="nav-link"><i class="undefined"></i>设计模式</a></li><li class="dropdown-item"><a href="/categories/前端/" class="nav-link"><i class="undefined"></i>前端</a></li><li class="dropdown-item"><a href="/categories/HTML/" class="nav-link"><i class="undefined"></i>HTML</a></li><li class="dropdown-item"><a href="/categories/JavaScript/" class="nav-link"><i class="undefined"></i>JavaScript</a></li><li class="dropdown-item"><a href="/categories/Node/" class="nav-link"><i class="undefined"></i>Node</a></li><li class="dropdown-item"><a href="/categories/其他/" class="nav-link"><i class="undefined"></i>其他</a></li><li class="dropdown-item"><a href="/categories/python/" class="nav-link"><i class="undefined"></i>python</a></li><li class="dropdown-item"><a href="/categories/阅读笔记/" class="nav-link"><i class="undefined"></i>阅读笔记</a></li><li class="dropdown-item"><a href="/categories/Vue/" class="nav-link"><i class="undefined"></i>Vue</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>标签</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>时间轴</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>关于</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none"><li class="dropdown-item"><a href="/views/about/" class="nav-link"><i class="iconfont reco-account"></i>关于我</a></li><li class="dropdown-item"><a href="https://juejin.cn/user/2365804753993613" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-juejin"></i>掘金<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><a href="https://github.com/zjgyb" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a></li></ul></div></div></nav></div></header><div class="sidebar-mask" data-v-0f44a727></div><aside class="sidebar" data-v-0f44a727><div class="personal-info-wrapper" data-v-5aaeb100 data-v-0f44a727><img src="/avatar.jpg" alt="author-avatar" class="personal-img" data-v-5aaeb100><h3 class="name" data-v-5aaeb100>Tony</h3><div class="num" data-v-5aaeb100><div data-v-5aaeb100><h3 data-v-5aaeb100>91</h3><h6 data-v-5aaeb100>Articles</h6></div><div data-v-5aaeb100><h3 data-v-5aaeb100>175</h3><h6 data-v-5aaeb100>Tags</h6></div></div><ul class="social-links" data-v-5aaeb100></ul><hr data-v-5aaeb100></div><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>分类</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none"><li class="dropdown-item"><a href="/categories/算法/" class="nav-link"><i class="undefined"></i>算法</a></li><li class="dropdown-item"><a href="/categories/CSS/" class="nav-link"><i class="undefined"></i>CSS</a></li><li class="dropdown-item"><a href="/categories/设计模式/" class="nav-link"><i class="undefined"></i>设计模式</a></li><li class="dropdown-item"><a href="/categories/前端/" class="nav-link"><i class="undefined"></i>前端</a></li><li class="dropdown-item"><a href="/categories/HTML/" class="nav-link"><i class="undefined"></i>HTML</a></li><li class="dropdown-item"><a href="/categories/JavaScript/" class="nav-link"><i class="undefined"></i>JavaScript</a></li><li class="dropdown-item"><a href="/categories/Node/" class="nav-link"><i class="undefined"></i>Node</a></li><li class="dropdown-item"><a href="/categories/其他/" class="nav-link"><i class="undefined"></i>其他</a></li><li class="dropdown-item"><a href="/categories/python/" class="nav-link"><i class="undefined"></i>python</a></li><li class="dropdown-item"><a href="/categories/阅读笔记/" class="nav-link"><i class="undefined"></i>阅读笔记</a></li><li class="dropdown-item"><a href="/categories/Vue/" class="nav-link"><i class="undefined"></i>Vue</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>标签</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>时间轴</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>关于</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none"><li class="dropdown-item"><a href="/views/about/" class="nav-link"><i class="iconfont reco-account"></i>关于我</a></li><li class="dropdown-item"><a href="https://juejin.cn/user/2365804753993613" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-juejin"></i>掘金<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><a href="https://github.com/zjgyb" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a></li></ul></div></div></nav></aside><div class="password-shadow password-wrapper-in" style="display:none" data-v-355e03f9 data-v-0f44a727><h3 class="title" data-v-355e03f9 data-v-355e03f9>WebSocket知识盘点</h3><label id="box" class="inputBox" data-v-355e03f9 data-v-355e03f9><input type="password" data-v-355e03f9><span data-v-355e03f9>Konck! Knock!</span><button data-v-355e03f9>OK</button></label><div class="footer" data-v-355e03f9 data-v-355e03f9><span data-v-355e03f9><i class="iconfont reco-theme" data-v-355e03f9></i><a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-355e03f9>vuePress-theme-reco</a></span><span data-v-355e03f9><i class="iconfont reco-copyright" data-v-355e03f9></i><a data-v-355e03f9><span data-v-355e03f9>Tony</span>  <span data-v-355e03f9>2018 -</span>2023</a></span></div></div><div data-v-0f44a727><main class="page"><section><div class="page-title"><h1 class="title">WebSocket知识盘点</h1><div data-v-5eef61be><i class="iconfont reco-account" data-v-5eef61be><span data-v-5eef61be>Tony</span></i><i class="iconfont reco-date" data-v-5eef61be><span data-v-5eef61be>5/6/2023</span></i><i class="iconfont reco-eye" data-v-5eef61be><span id="/views/js/2023/2023-05-06.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-5eef61be><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:400;color:#999"></a></span></i></div></div><div class="theme-reco-content content__default"><h2 id="建立websocket"><a href="#建立websocket" class="header-anchor">#</a>建立WebSocket</h2><p>在客户端创建一个<code>WebSocket</code>应用程序其实很简单，只需要简单的一行，例如：</p><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:8080'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>语法也就两个参数</p><div class="language-ts line-numbers-mode"><pre class="language-ts"><code>webSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> protocols<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="url"><a href="#url" class="header-anchor">#</a>url</h3><p>需要连接的服务器地址，一般以<code>ws</code>或者<code>wss</code>开头，这两种不同的协议可以类比为<code>http</code>和<code>https</code>的差异</p><h4 id="疑问一"><a href="#疑问一" class="header-anchor">#</a>疑问一</h4><p><code>WebSocket</code>自定义一套协议机制，那为什么不采用<code>http</code>协议呢？</p><blockquote><p>WebSocket的连接协议也可以用于浏览器之外的场景，可以通过非 HTTP 协商机制交换数据。</p></blockquote><h4 id="疑问二"><a href="#疑问二" class="header-anchor">#</a>疑问二</h4><p>如果我设置一个错误协议的 URL 或者是一个正确协议但不存在的 URL 分别会出现什么错误提示？</p><p>这里手动测试一下就行，例如：</p><p>错误协议的 URL：</p><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'http://localhost'</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/ws_url_1.de393f6e.png" alt="image"></p><p>正确协议但不存在的 URL：</p><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:555'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> event <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> event <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>code<span class="token punctuation">,</span> event<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><img src="/assets/img/ws_url_2.11d54419.png" alt="image"></p><h3 id="protocols"><a href="#protocols" class="header-anchor">#</a>protocols</h3><p>可以是一个协议字符串或一个协议字符串数组</p><h4 id="疑问一-2"><a href="#疑问一-2" class="header-anchor">#</a>疑问一</h4><p>这个协议名的约束是啥？这里看<a href="https://www.rfc-editor.org/rfc/rfc6455#section-4.1" target="_blank" rel="noopener noreferrer">RFC 规范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a></p><blockquote><p>The request MAY include a header field with the name |Sec-WebSocket-Protocol|. If present, this value indicates one or more comma-separated subprotocol the client wishes to speak, ordered by preference. The elements that comprise this value MUST be non-empty strings with characters in the range U+0021 to U+007E not including separator characters as defined in [RFC2616] and MUST all be unique strings. The ABNF for the value of this header field is 1#token, where the definitions of constructs and rules are as given in [RFC2616].</p></blockquote><p>请求可能会包含一个叫<code>Sec-WebSocket-Protocol</code>的请求字段。如果这个字段存在，那么根据需要客户端可以使用单个或者多个以逗号分隔的子协议。组成这个值的元素必须是非空字符串，字符在 U+0021 到 U+007E 范围内，不包括 [RFC2616] 中定义的分隔符并且必须都是唯一字符串。这个头字段值的 ABNF 是1#token，其中的定义构造和规则在 [RFC2616] 中给出。</p><p>其中 RFC2616 中定义的分隔符为，如图所示：</p><p><img src="/assets/img/ws_separator.8ac50cd1.png" alt="image"></p><p>如果协议中包含了这些分隔符会出现什么场景，如下图所示：</p><p><img src="/assets/img/ws_separator_error.f311b632.png" alt="image"></p><p>解释：</p><ol><li><code>U+0021 到 U+007E</code>之间的字符是啥？</li></ol><p>可以参考<a href="https://en.wikipedia.org/wiki/List_of_Unicode_characters" target="_blank" rel="noopener noreferrer">维基百科<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a>，由此可以得出中文名是不符合规范的，它不在这个范围内</p><ol start="2"><li><code>ABNF</code>是什么？</li></ol><p><code>Augmented Backus–Naur form</code>的缩写，这里可以参考<a href="https://en.wikipedia.org/wiki/Augmented_Backus%E2%80%93Naur_form" target="_blank" rel="noopener noreferrer">维基百科<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a></p><ol start="3"><li><code>1#token</code>是什么？</li></ol><p>在<code>WebSocket</code>协议中，<code>1#token</code>是一个<code>ABNF</code>规则，用于定义一个或多个标记（<code>token</code>）的序列。其中，#表示“至少一个”，1#表示“至少一个标记”。标记是一种由可见字符组成的字符串，用于表示协议中的各种元素，例如请求头字段、响应头字段、URI等。标记由一系列字符组成，其中每个字符都必须是以下范围内的字符：U+0021到U+007E：ASCII可见字符，不包括空格和分隔符。在1#token规则中，标记之间用逗号分隔。例如，以下是一个符合1#token规则的字符串：token1,token2,token3，在这个字符串中，有三个标记，它们之间用逗号分隔。</p><p>在<a href="https://www.rfc-editor.org/rfc/rfc2616#section-2.1" target="_blank" rel="noopener noreferrer">RFC2616<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a>中也有关于<code>1#element</code>的作用</p><h4 id="疑问二-2"><a href="#疑问二-2" class="header-anchor">#</a>疑问二</h4><p><strong>这个协议有什么作用呢？</strong></p><p>在<a href="https://www.rfc-editor.org/rfc/rfc6455#section-1.9" target="_blank" rel="noopener noreferrer">RFC6455<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a>中说明了协议的使用，但是这个章节在一开始也说明了这个使用规范是<strong>非标准</strong>，因此这个协议的用途其实可以多元化，这个协议的目的是一个服务器可以根据指定的<code>protocol</code>来应对不同的互动情况</p><p>下面列举了几种用途：</p><ol><li>协议为多个域名，为不同网站提供服务</li></ol><p>例如一个<code>WebSocket</code>服务器为两个不同网站提供服务：</p><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:80'</span><span class="token punctuation">,</span> <span class="token string">'chat.example.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ws1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:80'</span><span class="token punctuation">,</span> <span class="token string">'chat.example.org'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>或者给不同版本的网站提供服务：</p><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:80'</span><span class="token punctuation">,</span> <span class="token string">'bookings.example.net'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ws1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:80'</span><span class="token punctuation">,</span> <span class="token string">'v2.bookings.example.net'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="2"><li>作为消息格式，在<code>http</code>协议中的<code>Content-Type</code>能够返回不同的响应内容来代表不同的数据格式，例如<code>application/json</code>、<code>text/html</code>，那么这个参数也可以用来表示期望的数据内容，例如可以设置<code>json</code>、<code>text</code></li><li>作为加解密<code>key</code>，比如使用这个协议的<code>key</code>作为加密的密钥</li></ol><p>总而言之：这个<code>protocol</code>可以根据需要来动态设置</p><h2 id="实例属性"><a href="#实例属性" class="header-anchor">#</a>实例属性</h2><h3 id="protocol"><a href="#protocol" class="header-anchor">#</a><code>protocol</code></h3><p>服务器支持的协议，如果未指定协议，那么返回为空</p><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:80'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ws<span class="token punctuation">.</span>protocol <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>如果选择了一种协议</p><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// 服务器</span>
<span class="token comment">// 例如使用ws包进行选择</span>
<span class="token keyword">const</span> wss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocketServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    port<span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span>

    <span class="token comment">// 选择最后一种协议</span>
    <span class="token function-variable function">handleProtocols</span><span class="token operator">:</span> <span class="token punctuation">(</span>protocols<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>protocols<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 客户端</span>
<span class="token keyword">const</span> ws1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:80'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ws<span class="token punctuation">.</span>protocol <span class="token operator">===</span> <span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="url-2"><a href="#url-2" class="header-anchor">#</a>url</h3><p>创建<code>WebSocket</code>实例对象的<code>URL</code>，<strong>注意</strong>这个返回的url是符合规范的</p><p>例如：</p><ol><li>自动补全：</li></ol><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// 虽然后缀未加/，但是获取的时候会自动加上</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'ws://localhost:55'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ws<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ws://localhost:55/</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="2"><li>默认端口不显示：</li></ol><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'ws://localhost:80/'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ws<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ws://localhost/</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="readystate"><a href="#readystate" class="header-anchor">#</a>readyState</h3><p>当前<code>WebSocket</code>的连接状态</p><ul><li>0(WebSocket.CONNECTING): 正在连接中</li><li>1(WebSocket.OPEN): 已经连接并且可以通信</li><li>2(WebSocket.CLOSING): 正在关闭</li><li>3(WebSocket.CLOSED): 连接关闭或者连接未成功</li></ul><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'ws://localhost:80/'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ws<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>

    <span class="token comment">// 0, 1, 2, 3</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>WebSocket<span class="token punctuation">.</span><span class="token constant">CONNECTING</span><span class="token punctuation">,</span> WebSocket<span class="token punctuation">.</span><span class="token constant">OPEN</span><span class="token punctuation">,</span> WebSocket<span class="token punctuation">.</span><span class="token constant">CLOSING</span><span class="token punctuation">,</span> WebSocket<span class="token punctuation">.</span><span class="token constant">CLOSED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="binarytype"><a href="#binarytype" class="header-anchor">#</a>binaryType</h3><p>返回<code>WebSocket</code>连接所传输的二进制数据类型</p><p>存在两种：<code>blob</code>（默认值）、<code>ArrayBuffer</code></p><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'ws://localhost:80/'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ws<span class="token punctuation">.</span>binaryType<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// blob</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这个值由<strong>客户端</strong>自己决定</p><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'ws://localhost:80/'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span>binaryType <span class="token operator">=</span> <span class="token string">'arraybuffer'</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ws<span class="token punctuation">.</span>binaryType<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// arraybuffer</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="bufferedamount"><a href="#bufferedamount" class="header-anchor">#</a>bufferedAmount</h3><blockquote><p><strong>是一个只读属性，用于返回已经被</strong>send()方法放入队列中但还没有被发送到网络中的数据的字节数。一旦队列中的所有数据被发送至网络，则该属性值将被重置为 0。但是，若在发送过程中连接被关闭，则属性值不会重置为 0。如果你不断地调用send()，则该属性值会持续增长</p></blockquote><p>那么这个属性有什么用呢？这里问问<code>ChatGPT</code></p><p><img src="/assets/img/bufferedAmount.3051d06c.png" alt="image"></p><p>整体思路也就是有一个缓冲区概念，如果当前正在发送数据，那么放入缓冲区中，否则直接发送数据</p><h3 id="extensions"><a href="#extensions" class="header-anchor">#</a>extensions</h3><p>输出服务端已选择的拓展值，具体可以查看<a href="https://www.rfc-editor.org/rfc/rfc6455#section-9" target="_blank" rel="noopener noreferrer">RFC6455 Extensions<br><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a></p><p>值得注意的是这个值由客户端决定需要哪些拓展值，如果客户端不存在，那么服务端就不应该去设置</p><p>目前我<code>Chrome</code>中默认存在两种拓展值，<code>permessage-deflate</code>和<code>client_max_window_bits</code></p><h4 id="permessagedeflate"><a href="#permessagedeflate" class="header-anchor">#</a>perMessageDeflate</h4><p>使用<a href="https://en.wikipedia.org/wiki/Deflate" target="_blank" rel="noopener noreferrer">deflate<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a>压缩技术压缩消息，</p><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// 服务端</span>
<span class="token keyword">const</span> wss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocketServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    port<span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
    perMessageDeflate<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="/assets/img/ws_extension.0f246681.png" alt="image"></p><h4 id="client-max-window-bits"><a href="#client-max-window-bits" class="header-anchor">#</a>client_max_window_bits</h4><p>用于控制客户端压缩拓展的最大窗口大小</p><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> wss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocketServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    port<span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
    perMessageDeflate<span class="token operator">:</span> <span class="token punctuation">{</span>
        clientMaxWindowBits<span class="token operator">:</span> <span class="token number">8</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="实例方法"><a href="#实例方法" class="header-anchor">#</a>实例方法</h2><h3 id="close"><a href="#close" class="header-anchor">#</a>close</h3><p>关闭<code>WebSocket</code>，语法为<code>WebSocket.close(code, reason)</code></p><h4 id="code"><a href="#code" class="header-anchor">#</a>code</h4><p>数字状态码，它表示的是<code>WebSocket</code>关闭后打印出的值，在关闭事件<code>CloseEvent</code>内获取，未赋值的情况下默认<code>1005</code></p><ol><li><code>0-999</code>：未使用状态码</li><li><code>1000-2999</code>：有具体定义的含义和未来可能被定义的保留值</li><li><code>3000-3999</code>：提供给库和框架使用</li><li><code>4000-4999</code>：提供给用户自定义</li></ol><p>具体各个数字代表的含义可以看<a href="https://www.rfc-editor.org/rfc/rfc6455#section-7.4.1" target="_blank" rel="noopener noreferrer">RFC6455-The WebSocket Protocol<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a></p><h4 id="reason"><a href="#reason" class="header-anchor">#</a>reason</h4><p>连接关闭的原因，最大字符串长度不能超过 123 个<strong>字节</strong></p><p>如果超过了会发生什么事？使用代码测试一下，结果如下图所示：</p><p><img src="/assets/img/ws_reason_error.798d20f7.png" alt="image"></p><p>显而易见，直接抛出异常</p><h4 id="举几个案例"><a href="#举几个案例" class="header-anchor">#</a>举几个案例</h4><ol><li>未建立连接之前或正在建立连接之前关闭</li></ol><p>最终打印出<code>1006</code>，具体原因在另一篇<a href="https://juejin.cn/post/7222186286563672119" target="_blank" rel="noopener noreferrer">WebSocket疑问解答<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a>给出</p><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:80/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> event <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1006, ''</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>code<span class="token punctuation">,</span> event<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="2"><li>建立连接后主动关闭</li></ol><p>其中<code>1005</code>表示表示没有收到预期的状态码，如果手动加上状态码和原因，那么输出的就是手动赋值的状态码以及原因</p><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:80/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ws<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> event <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1005, ''</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>code<span class="token punctuation">,</span> event<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ol start="3"><li>服务器代码主动断开</li></ol><p>客户端打印<code>1005</code>，如果手动加上状态码和原因，那么输出的就是手动赋值的状态码以及原因</p><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> WebSocketServer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ws'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> wss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocketServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    port<span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

wss<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ws<span class="token punctuation">,</span> req<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ws<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="4"><li>服务器进程关闭</li></ol><p>手动把开启的服务器进程杀掉，那么客户端显示的失败状态码为<code>1006</code>，原因为空字符串</p><h3 id="send"><a href="#send" class="header-anchor">#</a>send</h3><p>发送消息，语法为<code>WebSocket.send(data)</code></p><h4 id="data"><a href="#data" class="header-anchor">#</a>data</h4><p>一共有四种类型可以作为传输数据</p><ol><li><code>string</code></li></ol><div class="language-ts line-numbers-mode"><pre class="language-ts"><code>ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li><code>ArrayBuffer</code></li></ol><div class="language-ts line-numbers-mode"><pre class="language-ts"><code>ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> view <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataView</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span>
        <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span>
        <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">33</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        view<span class="token punctuation">.</span><span class="token function">setUint8</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="3"><li><code>Blob</code></li></ol><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// 客户端</span>
ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Hello World!'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 服务器</span>
wss<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ws<span class="token punctuation">,</span> req<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Hello World!</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol start="4"><li><code>TypedArray</code>或者<code>DataView</code></li></ol><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// 客户端</span>
ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span>
        <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span>
        <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">33</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 服务端</span>
wss<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ws<span class="token punctuation">,</span> req<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Hello World!</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>或者</p><div class="language-ts line-numbers-mode"><pre class="language-ts"><code>ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> view <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataView</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span>
        <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span>
        <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">33</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        view<span class="token punctuation">.</span><span class="token function">setUint8</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="事件"><a href="#事件" class="header-anchor">#</a>事件</h2><p>和其他事件一致，有两种声明方式</p><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="open"><a href="#open" class="header-anchor">#</a>open</h3><p>当<code>WebSocket</code>处于<code>open</code>状态，即<code>readyState</code>为<code>1</code>时触发</p><p>该打开事件参数为普通的<a href="https://developer.mozilla.org/en-US/docs/Web/API/Event" target="_blank" rel="noopener noreferrer">Event<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a></p><h3 id="message"><a href="#message" class="header-anchor">#</a>message</h3><p>当<code>WebSocket</code>接收到消息触发</p><p>该消息事件参数为<a href="https://developer.mozilla.org/en-US/docs/Web/API/MessageEvent" target="_blank" rel="noopener noreferrer">MessageEvent<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a>，继承于普通的<a href="https://developer.mozilla.org/en-US/docs/Web/API/Event" target="_blank" rel="noopener noreferrer">Event<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a>，相比于普通的 Event，该事件多了五个参数</p><ul><li>data：接收到的消息</li><li>origin：发送消息的来源</li><li>lastEventId：事件唯一ID</li><li>source：消息发送者</li><li>ports：一组<a href="https://developer.mozilla.org/en-US/docs/Web/API/MessagePort" target="_blank" rel="noopener noreferrer">MessagePort<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a>对象，表示与发送消息的通道关联的端口</li></ul><p>依次打印出来如图所示：</p><p><img src="data:image/png;base64,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" alt="image"></p><p><strong>注意：</strong></p><p>在这里其实可以不用关注<code>lastEventId</code>，因为<a href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-lasteventid-dev" target="_blank" rel="noopener noreferrer">HTML规范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a>中说明了它为<a href="https://html.spec.whatwg.org/multipage/server-sent-events.html#server-sent-events" target="_blank" rel="noopener noreferrer">SSE<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a>提供</p><p><code>source</code>和<code>ports</code>也可以不用关注，具体看<a href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-lasteventid-dev" target="_blank" rel="noopener noreferrer">HTML规范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a></p><h3 id="error"><a href="#error" class="header-anchor">#</a>error</h3><p>当<code>WebSocket</code>的连接由于一些错误事件的发生 (例如无法发送一些数据) 而被关闭时，一个<code>error</code>事件将被引发</p><p>该关闭事件参数为普通的<a href="https://developer.mozilla.org/en-US/docs/Web/API/Event" target="_blank" rel="noopener noreferrer">Event<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a></p><h3 id="close-2"><a href="#close-2" class="header-anchor">#</a>close</h3><p>当<code>WebSocket</code>连接关闭后被触发，即<code>readyState</code>为<code>3</code>时触发</p><p>该关闭事件参数为<a href="https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent" target="_blank" rel="noopener noreferrer">CloseEvent<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a>，继承于普通的<a href="https://developer.mozilla.org/en-US/docs/Web/API/Event" target="_blank" rel="noopener noreferrer">Event<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a>，相比于普通的Event，该事件多了三个参数</p><ul><li>code: 关闭连接的状态码</li><li>reason: 关闭连接的原因</li><li>wasClean: Boolean，连接是否完全关闭</li></ul><p>前两个参与之前已经介绍过，这里说一下<code>wasClean</code>，如果是代码手动<code>close</code>，那么一般为<code>true</code>，那么什么场景下为<code>false</code>呢？</p><ol><li>突然断开服务器进程</li><li>连接未建立时手动调用<code>close</code>方法关闭</li></ol><h2 id="参考文章"><a href="#参考文章" class="header-anchor">#</a>参考文章</h2><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_client_applications" target="_blank" rel="noopener noreferrer">MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a></li><li><a href="https://hpbn.co/websocket/#websocket-api" target="_blank" rel="noopener noreferrer">《High Performance Browser Networking》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a></li><li><a href="https://www.rfc-editor.org/rfc/rfc2616" target="_blank" rel="noopener noreferrer">RFC2616-Hypertext Transfer Protocol -- HTTP/1.1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a></li><li><a href="https://www.rfc-editor.org/rfc/rfc6455" target="_blank" rel="noopener noreferrer">RFC6455-The WebSocket Protocol<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a></li><li><a href="https://en.wikipedia.org/wiki/Deflate" target="_blank" rel="noopener noreferrer">wikipedia deflate<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="sr-only">(opens new window)</span></span></a></li></ul></div></section><footer class="page-edit"><div class="last-updated"><span class="prefix">Last Updated:</span><span class="time">5/24/2023, 12:28:45 AM</span></div></footer><div class="comments-wrapper"></div><ul class="side-bar sub-sidebar-wrapper" style="width:12rem" data-v-898d6c54><li class="level-2" data-v-898d6c54><a href="/views/js/2023/2023-05-06.html#建立websocket" class="sidebar-link reco-side-建立websocket" data-v-898d6c54>建立WebSocket</a></li><li class="level-3" data-v-898d6c54><a href="/views/js/2023/2023-05-06.html#url" class="sidebar-link reco-side-url" data-v-898d6c54>url</a></li><li class="level-3" data-v-898d6c54><a href="/views/js/2023/2023-05-06.html#protocols" class="sidebar-link reco-side-protocols" data-v-898d6c54>protocols</a></li><li class="level-2" data-v-898d6c54><a href="/views/js/2023/2023-05-06.html#实例属性" class="sidebar-link reco-side-实例属性" data-v-898d6c54>实例属性</a></li><li class="level-3" data-v-898d6c54><a href="/views/js/2023/2023-05-06.html#protocol" class="sidebar-link reco-side-protocol" data-v-898d6c54>protocol</a></li><li class="level-3" data-v-898d6c54><a href="/views/js/2023/2023-05-06.html#url-2" class="sidebar-link reco-side-url-2" data-v-898d6c54>url</a></li><li class="level-3" data-v-898d6c54><a href="/views/js/2023/2023-05-06.html#readystate" class="sidebar-link reco-side-readystate" data-v-898d6c54>readyState</a></li><li class="level-3" data-v-898d6c54><a href="/views/js/2023/2023-05-06.html#binarytype" class="sidebar-link reco-side-binarytype" data-v-898d6c54>binaryType</a></li><li class="level-3" data-v-898d6c54><a href="/views/js/2023/2023-05-06.html#bufferedamount" class="sidebar-link reco-side-bufferedamount" data-v-898d6c54>bufferedAmount</a></li><li class="level-3" data-v-898d6c54><a href="/views/js/2023/2023-05-06.html#extensions" class="sidebar-link reco-side-extensions" data-v-898d6c54>extensions</a></li><li class="level-2" data-v-898d6c54><a href="/views/js/2023/2023-05-06.html#实例方法" class="sidebar-link reco-side-实例方法" data-v-898d6c54>实例方法</a></li><li class="level-3" data-v-898d6c54><a href="/views/js/2023/2023-05-06.html#close" class="sidebar-link reco-side-close" data-v-898d6c54>close</a></li><li class="level-3" data-v-898d6c54><a href="/views/js/2023/2023-05-06.html#send" class="sidebar-link reco-side-send" data-v-898d6c54>send</a></li><li class="level-2" data-v-898d6c54><a href="/views/js/2023/2023-05-06.html#事件" class="sidebar-link reco-side-事件" data-v-898d6c54>事件</a></li><li class="level-3" data-v-898d6c54><a href="/views/js/2023/2023-05-06.html#open" class="sidebar-link reco-side-open" data-v-898d6c54>open</a></li><li class="level-3" data-v-898d6c54><a href="/views/js/2023/2023-05-06.html#message" class="sidebar-link reco-side-message" data-v-898d6c54>message</a></li><li class="level-3" data-v-898d6c54><a href="/views/js/2023/2023-05-06.html#error" class="sidebar-link reco-side-error" data-v-898d6c54>error</a></li><li class="level-3" data-v-898d6c54><a href="/views/js/2023/2023-05-06.html#close-2" class="sidebar-link reco-side-close-2" data-v-898d6c54>close</a></li><li class="level-2" data-v-898d6c54><a href="/views/js/2023/2023-05-06.html#参考文章" class="sidebar-link reco-side-参考文章" data-v-898d6c54>参考文章</a></li></ul></main></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div></div></div></div><script src="/assets/js/app.0d0b816d.js" defer></script><script src="/assets/js/5.892919e7.js" defer></script><script src="/assets/js/1.2755fd70.js" defer></script><script src="/assets/js/11.7306927b.js" defer></script><script src="/assets/js/28.66f3674d.js" defer></script></body></html>